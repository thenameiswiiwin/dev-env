#!/usr/bin/env bash

OS="$(uname -s)"
echo "Starting system cleanup for $OS..."

if [[ "$OS" == "Darwin" ]]; then
  # macOS cleanup
  echo "Cleaning brew packages..."
  brew cleanup
  brew autoremove

  echo "Cleaning system caches..."
  sudo rm -rf /Library/Caches/* &>/dev/null
  rm -rf ~/Library/Caches/* &>/dev/null

  echo "Cleaning logs..."
  sudo rm -rf /private/var/log/asl/*.asl &>/dev/null

  echo "Cleaning app temp files..."
  find /private/var/folders -type f -name "*.tmp" -delete &>/dev/null

  echo "Emptying trash..."
  rm -rf ~/.Trash/* &>/dev/null

elif [[ "$OS" == "Linux" ]]; then
  # Linux cleanup
  echo "Cleaning package caches..."
  if command -v apt &>/dev/null; then
    sudo apt clean
    sudo apt autoremove -y
  elif command -v pacman &>/dev/null; then
    sudo pacman -Sc --noconfirm
    sudo pacman -Rns "$(pacman -Qtdq)" --noconfirm 2>/dev/null
  elif command -v dnf &>/dev/null; then
    sudo dnf clean all
    sudo dnf autoremove -y
  elif command -v apk &>/dev/null; then
    sudo apk cache clean
  fi

  echo "Cleaning temporary files..."
  sudo rm -rf /tmp/* &>/dev/null

  echo "Cleaning journal logs..."
  if command -v journalctl &>/dev/null; then
    sudo journalctl --vacuum-time=7d
  fi
fi

# Common cleanup for all systems
echo "Cleaning npm cache..."
if command -v npm &>/dev/null; then
  npm cache clean --force
fi

echo "Cleaning pip cache..."
if command -v pip3 &>/dev/null; then
  pip3 cache purge
fi

echo "Cleaning Docker resources..."
if command -v docker &>/dev/null; then
  docker system prune -f
fi

echo "System cleanup completed!"
